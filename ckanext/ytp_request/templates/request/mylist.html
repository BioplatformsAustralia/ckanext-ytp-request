{% extends "request/page.html" %}

{% block breadcrumb_content %}
  <li><a href="{{ h.url_for('member_requests_mylist') }}">{{ _('Memberships') }}</a></li>
  <li><a href="{{ h.url_for('user.read', id=c.userobj.name) }}">{{ c.userobj.display_name }}</a></li>
  <li class="active"><a href="#">{{ _('Memberships and Requests') }}</a></li>
{% endblock %}

{% block subtitle %}{{ _('My own memberships') }}{% endblock %}

{% block secondary_content %}
  <section class="module module-narrow">
    <h2 class="module-heading"><i class="icon-large icon-info-sign"></i> {{ _('My own memberships') }}</h2>
    <div class="module-content">
      <p>
        {% trans -%}
        All membership and memberships requests are listed here. You can cancel any pending request or already accepted membership from the menu on the right.
        {%- endtrans %}
      </p>
    </div>
  </section>
{% endblock %}

{% block primary_content %}
  <section class="module">
    <div class="module-content">

      <h1>{% trans %}My memberships{% endtrans %}</h1>

      {% if my_requests %}
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
             <th>{% trans %}Organization{% endtrans %}</th>
             <th colspan="2">{% trans %}Details{% endtrans %}</th>
          </tr>
        </thead>
        <tfoot> </tfoot>
        <tbody>
        {% for mrequest in my_requests %}
          <tr style="border-top: 3px solid black">
            <td rowspan="6">{{ mrequest.organization_display_name }}</td>
            <td>
	       {% if mrequest.state == "active" %}
	         <strong>
	         {{ mrequest.role|capitalize }}
		 </strong>
	       {% endif %}
	    </td>
            <td>{% if h.check_access('member_request_membership_cancel', {'organization_id': mrequest.organization_id}) %}
              {% set locale = h.dump_json({'content': _('Are you sure you want to end the membership?')}) %}
              <a class="btn btn-danger" href="{{ h.url_for('member_request_membership_cancel', organization_id=mrequest.organization_id) }}" data-module="confirm-action" data-module-i18n="{{ locale }}">
              <i class="fa fa-minus-circle"></i>
                {% trans %}Cancel membership{% endtrans %}
              </a>
              {% elif h.check_access('member_request_cancel', {'organization_id': mrequest.organization_id}) %}
              {% set locale = h.dump_json({'content': _('Are you sure you want to cancel this pending request?')}) %}
              <a class="btn btn-warning" href="{{ h.url_for('member_request_cancel', organization_id=mrequest.organization_id) }}" data-module="confirm-action" data-module-i18n="{{ locale }}">
              <i class="fa fa-minus-circle"></i>
                {% trans %}Cancel request{% endtrans %}
              </a>
              {% endif %}
            </td>
          </tr>
          <tr>
             <td>{% trans %}Status{% endtrans %}</td>
             <td>{{ mrequest.state|capitalize }}
	       {% if mrequest.state != "active" %}
	         ( {{ mrequest.role }} )
	       {% endif %}
	     </td>
          </tr>
          <tr>
             <td>{% trans %}Message{% endtrans %}</td>
             <td>{{ mrequest.message }}</td>
          </tr>
          <tr>
             <td>{% trans %}Request date{% endtrans %}</td>
             <td>{{ mrequest.request_date }}</td>
          </tr>
          <tr>
             <td>{% trans %}Handling date{% endtrans %}</td>
             <td>{{ mrequest.handling_date }}</td>
          </tr>
          <tr>
             <td>{% trans %}Handler{% endtrans %}</td>
             <td>{{ mrequest.handled_by }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>{% trans %}No requests found.{% endtrans %}</p>
      {% endif %}
    </div>
  </section>
{% endblock %}
