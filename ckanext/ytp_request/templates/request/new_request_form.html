{% import 'macros/form.html' as form %}
{% resource  "request_js/request.js" %}

      {% if my_requests %}
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
             <th>{% trans %}Organization{% endtrans %}</th>
             <th>{% trans %}Status{% endtrans %}</th>
          </tr>
        </thead>
        <tfoot> </tfoot>
        <tbody>
        {% for organization in organizations %}
          {% for mrequest in my_requests %}
	    {% if ( mrequest["organization_name"] == organization["name"] ) %}
            <tr>
              <td>{{ organization.display_name }}</td>
              <td>
                {% if mrequest.state == "active" %}
	          {{ mrequest.role|upper }}
		{% elif h.check_access('member_request_cancel', {'organization_id': mrequest.organization_id}) %}
                {% set locale = h.dump_json({'content': _('Are you sure you want to cancel this pending request?')}) %}
                <a class="btn btn-primary" href="{{ h.url_for('member_request_cancel', organization_id=mrequest.organization_id) }}" data-module="confirm-action" data-module-i18n="{{ locale }}">
                <i class="icon-circle-arrow-right"></i>
                  {% trans %}Cancel request{% endtrans %}
                </a>
		{% else %}
		  {# State is Never/Cancelled/Rejected #}
		  {% if h.check_access('member_request_create', {'organization_id': c.group_dict.id}) and not h.is_sysadmin(c.user) %}
                    <a class="btn btn-primary" href="{{ h.url_for('member_request_create', organization=organization.id, role=c.user_role, save="submit") }}">
                       <i class="fa fa-plus-circle"></i>
                       {% trans %}Request to Join{% endtrans %}
                    </a>
                  {% endif %}
                {% endif %}
	      </td>
            </tr>
            {% endif %}
          {% endfor %}
        {% endfor %}
        </tbody>
      </table>
      {% endif %}
