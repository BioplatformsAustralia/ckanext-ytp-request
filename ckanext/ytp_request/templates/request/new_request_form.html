{% import 'macros/form.html' as form %}
{% resource  "request_js/request.js" %}

      {% if my_requests %}
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
             <th>{% trans %}Organization{% endtrans %}</th>
             <th>{% trans %}Status{% endtrans %}</th>
          </tr>
        </thead>
        <tfoot> </tfoot>
        <tbody>
        {% for organization in organizations %}
          {% for mrequest in my_requests %}
	    {% if ( mrequest["organization_name"] == organization["name"] ) %}
            <tr>
              <td>{{ organization.display_name }}</td>
              <td>
                {% if mrequest.state == "active" %}
	          {{ mrequest.role|upper }}
		{% elif h.check_access('member_request_cancel', {'organization_id': mrequest.organization_id}) %}
                {% set locale = h.dump_json({'content': _('Are you sure you want to cancel this pending request?')}) %}
                <a class="btn btn-primary" href="{{ h.url_for('member_request_cancel', organization_id=mrequest.organization_id) }}" data-module="confirm-action" data-module-i18n="{{ locale }}">
                <i class="icon-circle-arrow-right"></i>
                  {% trans %}Cancel request{% endtrans %}
                </a>
		{% else %}
		  {# State is Never/Cancelled/Rejected #}
		  {% if h.check_access('member_request_create', {'organization_id': c.group_dict.id}) and not h.is_sysadmin(c.user) %}
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#memberRequestModal" data-organization="{{ organization.id }}" data-orgname="{{ organization.display_name }}">
                       <i class="fa fa-plus-circle"></i>
                       {% trans %}Request to join{% endtrans %}
		    </button>
                  {% endif %}
                {% endif %}
	      </td>
            </tr>
            {% endif %}
          {% endfor %}
        {% endfor %}
        </tbody>
      </table>
      {% endif %}


<form class="dataset-form form-horizontal" method="post" data-module="basic-form" id="membership-request-form">
<div class="modal fade" id="memberRequestModal" tabindex="-1" role="dialog" aria-labelledby="memberRequestModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="memberRequestModalLabel">
          {% trans %}Request to join{% endtrans %}
	  <span class="modal-orgname">
	  </span>
	</div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <div class="modal-reason">
	  Describe why you wish to be a part of this organization
	  </div>
          <div class="form-group">
            <label for="field-message" class="col-form-label">Request</label>
            <textarea class="form-control" id="field-message" name="message"></textarea>
          </div>
      </div>
      <input id="field-role" type="hidden" name="role" value="{{ c.user_role }}">
      <input id="field-organizations" type="hidden" name="organization" value="">
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <div class="form-actions">
          <button class="btn btn-primary" name="save" type="submit">
            <i class="fa fa-plus-circle"></i>
	    {% block save_text %}{{ _('Send request') }}{% endblock %}
	  </button>
        </div>
      </div>
    </div>
  </div>
</div>
</form>
